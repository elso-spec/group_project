---
title: "Presentation"
author: "Elisabeth Solmunde"
format: html
editor: visual
---

```{r setup, results='hide', message=FALSE, warning=FALSE}
# Packages
library(tidyverse)
library(ggplot2)
library(dplyr)
library(countrycode)
library(stringr)
library(gt)
library(viridis)
library(plotly)
library(sf)
library(gghalves)
library(rnaturalearth)
library(ggridges)


# Data
tuesdata <- tidytuesdayR::tt_load('2023-12-05')
life_expectancy <- tuesdata$life_expectancy
life_expectancy_different_ages <- tuesdata$life_expectancy_different_ages
life_expectancy_female_male <- tuesdata$life_expectancy_female_male
```

# Group project

## 1. Description of our data

We chose to use the data set *life_expectancy*, which consists of three data sets:

-   *life_expectancy*
-   *life_expectancy_female_male*
-   *life_expectancy_different_ages*

In this presentation, we focus on the first two data sets.

### 1.1 The *life_expectancy* data set

This data set contains the following variables:

-   Entity
    -   Is most often a country, but can also be regions (*e.g.* Europe, Americas), income groups (*e.g.* High-income countries, or development status (*e.g.* Developed countries))
-   Code
    -   Represents a country code (*e.g.* Afghanistan = AFG)
-   Year
    -   Self-explanatory?
-   LifeExpectancy
    -   The life expectancy in a country in that given year

**Let's take a quick look:**

```{r}
head(life_expectancy)
```

### 1.2 The *life_expectancy_female_male* data set

This data set contains the same variables as the abovementioned, expect for one:

-   LifeExpectancyDiffFM
    -   This variable is the difference in life expectancy between females and males in that given year

```{r}
head(life_expectancy_female_male)
```

## 2. Wrangling

First, we limit the follow-up time from 1950 to 2020. For the *life_expectancy* data set, we also add the variable *Decade*

```{r, message=FALSE, warning=FALSE}
life_expectancy <- life_expectancy |>
  filter(Year >= 1950 & Year <= 2020)

life_expectancy_female_male <- life_expectancy_female_male |>
  filter(Year >= 1950 & Year <= 2020)


life_expectancy <- life_expectancy |>
  mutate(Decade = case_when(Year >= 1950 & Year < 1960 ~ 1950,        # Create Decade columns 
                            Year >= 1960 & Year < 1970 ~ 1960,
                            Year >= 1970 & Year < 1980 ~ 1970,
                            Year >= 1980 & Year < 1990 ~ 1980,
                            Year >= 1990 & Year < 2000 ~ 1990,
                            Year >= 2000 & Year < 2010 ~ 2000,
                            Year >= 2010 & Year < 2020 ~ 2010)) |>
  filter(!is.na(Decade))                                              # Remove NAs
```

We then create the data sets life_expectancy_countries and life_expectancy_regions

```{r}
# This dataset contain only countries
life_expectancy_countries <- life_expectancy |>
  filter(!(is.na(Code) == T))                         # We remove rows with no Code, as these are assigned to countries only

life_expectancy_countries
```

```{r, warning=FALSE}
# This dataset contain only regions
life_expectancy_region <- life_expectancy |>
  filter(!(is.na(Code) == T)) |>
  mutate(
    Continent = countrycode(sourcevar = Entity,
                            origin = "country.name",
                            destination = "continent"),
    Region = countrycode(sourcevar = Entity,
                         origin = "country.name",
                         destination = "region")
  ) |>
  filter(!is.na(Region))

life_expectancy_region
```

## 3. Visualization 

**First, lets take a look at the changes in life expectancy over time:**

We'll start by looking at the continents, and then regions
```{r, message = FALSE, warning = FALSE}
life_expectancy_region |> 
  filter(!is.na(Continent)) |> 
  group_by(Continent, Decade) |> 
  summarise(mean_life_expectancy = mean(LifeExpectancy)) |> 
  ggplot(aes(x = Decade, y = mean_life_expectancy, color = Continent), na.rm = T) +
  geom_point() + 
  geom_smooth(se = F) + 
  scale_x_continuous(breaks = seq(1950, 2020, by = 10)) +
  theme_classic() +
  labs(
    x = "Year",
    y = "Mean life expectancy (years)",
    title = "Mean life expectancies from 1950 to 2020, by continent"
  )
```
```{r, message=FALSE, warning=FALSE}
life_expectancy_region |> 
  filter(!is.na(Region)) |> 
  group_by(Region, Decade) |> 
  summarise(mean_life_expectancy = mean(LifeExpectancy)) |> 
  ggplot(aes(x = Decade, y = mean_life_expectancy, color = Region), na.rm = T) +
  geom_point() + 
  geom_smooth(se = F) + 
  scale_x_continuous(breaks = seq(1950, 2020, by = 10)) +
  theme_classic() +
  labs(
    x = "Year",
    y = "Mean life expectancy (years)",
    title = "Mean life expectancies from 1950 to 2020, by region"
  )
```
```{r, message=FALSE, warning=FALSE}
# Life expectancy by region (1950-2020)
life_expectancy_region |> 
  group_by(Region, Year) |> 
  summarise(mean_le = mean(LifeExpectancy)) |> 
  ggplot(aes(x = Year, y = Region, fill = mean_le)) +
  geom_tile() +
  scale_fill_viridis_c(option = "plasma", name = "Life Expectancy") +
  labs(title = "Life Expectancy by Region (1960–2020)",
       x = "Year", y = "Region") +
  theme_minimal() +
  theme(axis.text.y = element_text(size = 6))
```

```{r, fig.height=20, fig.width=12, message=FALSE, warning=FALSE}
# Life expectancy by country (1950-2020)
ggplot(life_expectancy_region, aes(x = Year, y = Entity, fill = LifeExpectancy)) +
  geom_tile() + 
  facet_wrap( ~ Continent, scales = "free_y") +
  scale_fill_viridis_c(option = "plasma", name = "Life Expectancy") +
  labs(title = "Life Expectancy by Country (1960–2020)",
       x = "Year", y = "Country") +
  theme_minimal() +
  theme(axis.text.y = element_text(size = 6)) 
  
```


